# Monitorar arquivos e diretórios sensíveis
-w /home/ubuntu/.mozilla/               -p rwxa -k prevent_theft
-w /home/ubuntu/.config                 -p rwxa -k prevent_theft
-w /home/ubuntu/.ssh/                   -p rwxa -k prevent_theft
-w /home/ubuntu/.bash_history           -p rwxa -k prevent_theft

-w /home/ubuntu/admin_credentials.txt  -p rwxa -k prevent_theft
-w /home/ubuntu/cc_info.txt            -p rwxa -k prevent_theft
-w /home/ubuntu/db_url.txt             -p rwxa -k prevent_theft
-w /home/ubuntu/passwords.txt          -p rwxa -k prevent_theft
-w /home/ubuntu/aws_keys.txt           -p rwxa -k prevent_theft
-w /home/ubuntu/credentials.txt        -p rwxa -k prevent_theft
-w /home/ubuntu/dropbox_token.txt      -p rwxa -k prevent_theft
-w /home/ubuntu/private_key.pem        -p rwxa -k prevent_theft
-w /home/ubuntu/backups_list.txt       -p rwxa -k prevent_theft
-w /home/ubuntu/db.env                 -p rwxa -k prevent_theft
-w /home/ubuntu/github_token.txt       -p rwxa -k prevent_theft
-w /home/ubuntu/secrets_backup.txt     -p rwxa -k prevent_theft
-w /home/ubuntu/vpn/                   -p rwxa -k prevent_theft

# Detectar execução de scripts Python - CORRIGIDO
-a always,exit -F arch=b64 -S execve -F exe=/usr/bin/python3 -k python_exec
-a always,exit -F arch=b32 -S execve -F exe=/usr/bin/python3 -k python_exec
-a always,exit -F arch=b64 -S execve -F exe=/usr/bin/python -k python_exec
-a always,exit -F arch=b32 -S execve -F exe=/usr/bin/python -k python_exec

# Detectar criação de diretórios ocultos (persistência)
-a always,exit -F arch=b64 -S mkdir,mkdirat -k directory_creation
-a always,exit -F arch=b32 -S mkdir,mkdirat -k directory_creation

# Detectar modificações em Systemd user services
-w /home/ubuntu/.config/systemd/user/ -p rwxa -k systemd_user_service_mod

# Monitorar TODAS as conexões de rede - CORRIGIDO
-a always,exit -F arch=b64 -S connect -k network_connection
-a always,exit -F arch=b32 -S connect -k network_connection

# Monitorar especificamente conexões HTTP/HTTPS (portas 80, 443, 8080)
-a always,exit -F arch=b64 -S connect -F a2=16 -F "obj_level_low=80" -k infostealer_c2_connection
-a always,exit -F arch=b32 -S connect -F a2=16 -F "obj_level_low=80" -k infostealer_c2_connection
-a always,exit -F arch=b64 -S connect -F a2=16 -F "obj_level_low=443" -k infostealer_c2_connection
-a always,exit -F arch=b32 -S connect -F a2=16 -F "obj_level_low=443" -k infostealer_c2_connection
-a always,exit -F arch=b64 -S connect -F a2=16 -F "obj_level_low=8080" -k infostealer_c2_connection
-a always,exit -F arch=b32 -S connect -F a2=16 -F "obj_level_low=8080" -k infostealer_c2_connection

# Monitorar syscalls de socket para detectar comunicações de rede
-a always,exit -F arch=b64 -S socket -F a0=2 -F a1=1 -k network_connection
-a always,exit -F arch=b32 -S socket -F a0=2 -F a1=1 -k network_connection

# Monitorar uso de bibliotecas HTTP em Python (requests, urllib, http.client)
-w /usr/lib/python3.12/site-packages/requests/ -p r -k infostealer_c2_connection
-w /usr/lib/python3/dist-packages/requests/ -p r -k infostealer_c2_connection
-w /usr/lib/python3.12/http/ -p r -k infostealer_c2_connection

# Monitorar execução de comandos curl/wget suspeitos
-w /usr/bin/curl -p x -k infostealer_c2_connection
-w /usr/bin/wget -p x -k infostealer_c2_connection

# Exclusões para reduzir falsos positivos - Wazuh user
-a never,exit -F uid=113
-a never,exit -F gid=113